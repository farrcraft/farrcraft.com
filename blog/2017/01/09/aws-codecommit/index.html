<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=icon href=/favicon.png type=image/gif><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet><link rel=stylesheet href=/css/font.css media=all><meta property="og:title" content="AWS CodeCommit"><meta property="og:description" content="The Picture So Far I’ve used a number of VCS flavors and platforms over the years. I started with CVS, moved on to SVN for a good long while, and was finally converted over to Git long after it had achieved its critical mass. I had a sourceforge account (which I loved) long before it became the reviled product it is today, flirted for a bit with beanstalk, and now use github in its public and private forms on a daily basis."><meta property="og:type" content="article"><meta property="og:url" content="https://farrcraft.com/blog/2017/01/09/aws-codecommit/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2017-01-09T00:17:15+00:00"><meta property="article:modified_time" content="2017-01-09T00:17:15+00:00"><meta property="og:site_name" content="farrcraft.com"><meta name=twitter:card content="summary"><meta name=twitter:title content="AWS CodeCommit"><meta name=twitter:description content="The Picture So Far I’ve used a number of VCS flavors and platforms over the years. I started with CVS, moved on to SVN for a good long while, and was finally converted over to Git long after it had achieved its critical mass. I had a sourceforge account (which I loved) long before it became the reviled product it is today, flirted for a bit with beanstalk, and now use github in its public and private forms on a daily basis."><link rel=stylesheet href=/bootstrap-5/css/bootstrap.min.css media=all><link rel=stylesheet href=/css/header.css media=all><link rel=stylesheet href=/css/footer.css media=all><link rel=stylesheet href=/css/theme.css media=all><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#eaedf0;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#18191a;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{font-size:1rem;font-weight:400;line-height:1.5;text-align:left}</style><meta name=description content><link rel=stylesheet href=/css/single.css><script defer src=/fontawesome-5/all-5.15.4.js></script><title>AWS CodeCommit | farrcraft.com</title></head><body class=light onload=loading()><script src=/bootstrap-5/js/bootstrap.bundle.js></script>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header><nav class="pt-3 navbar navbar-expand-lg"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/favicon.png width=30 height=30 class="d-inline-block align-top">
farrcraft.com</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>About</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#experience aria-label=experience>Experience</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Projects</a></li><li class="nav-item navbar-text"><a class=nav-link href=/blog title="Blog posts">Blog</a></li><li class="nav-item navbar-text dropdown"><a class="nav-link dropdown-toggle" href id=navbarDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false title=Homebrew>Homebrew</a><div class="dropdown-menu shadow-lg rounded" aria-labelledby=navbarDropdown><a class="dropdown-item text-left nav-link" href=/homebrew title=Posts>Posts</a>
<a class="dropdown-item text-left nav-link" href=/brew-log title="Brew Log">Brew Log</a>
<a class="dropdown-item text-left nav-link" href=/bottle-labels title="Bottle Labels">Bottle Labels</a></div></li><li class="nav-item navbar-text"><a class=nav-link href=/food title=Food>Food</a></li><li class="nav-item navbar-text"><a class=nav-link href=/photography title=Photography>Photography</a></li><li class="nav-item navbar-text"><a class=nav-link href=/workshop title=Workshop>Workshop</a></li></ul><div class=text-center><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div></div></nav></header><div id=content><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><div class="title mb-5"><h1 class="text-center mb-4">AWS CodeCommit</h1><div class=text-center>Josh
<small>|</small>
Jan 9, 2017</div></div><article class="page-content p-2"><h2 id=the-picture-so-far>The Picture So Far</h2><p>I’ve used a number of VCS flavors and platforms over the years.  I started with CVS, moved on to SVN for a good long while, and was finally converted over to Git long after it had achieved its critical mass.  I had a sourceforge account (which I loved) long before it became the reviled product it is today, flirted for a bit with beanstalk, and now use github in its public and private forms on a daily basis.  I’ve even hosted my own private repository servers.</p><p>Most recently I ran a private gitlab installation on a t2.small AWS instance backed by a puny db.t2.micro RDS instance.  I don’t use it very much or very often, so it’s worked out pretty well and with little investment.  Or, at least it did for the first 408 days of uptime.  One day, the web interface just started returning 500 error messages.</p><p>After an embarrassing amount of time just trying to remember how to SSH into the server, I discovered there were apparent filesystem errors in the root volume.  The volume acted as if it were full even though it wasn’t.  I tried a few corrective actions on the instance to no avail.  It appeared that the only recourse would be to terminate the instance and start with a new one.  In theory, this wouldn’t be a big deal.  Even though this is a tiny personal server environment, I still built everything using AWS CloudFormation and Chef.  It’s been a while since I’ve touched the automation.  The bits have just been sitting there rotting away.  The Disaster Recovery scenario has also never been fully tested on this setup.  But, In Theory – It Should Work ™.</p><h2 id=a-time-for-change>A Time For Change</h2><p>DR curiosities aside, I decided to give an alternative a try rather than restore my existing Gitlab server.  I happened to stumble onto the AWS CodeCommit offering around the same time while working on a completely unrelated project.  This seemed to be a cheaper and easier solution for my needs.  The majority of features offered by a Gitlab or other similar product aren’t necessary for what I need.  Everything on top of SSH-based Git access is just frosting that I can as easily do without.</p><p>Now here’s the bad news.  My git server is dead at this point.  All I have to work with are the existing cloned working directories of my repositories.  I won’t be able to create mirrored clones directly from the server.</p><h2 id=getting-setup>Getting Setup</h2><p>There is a little bit of setup for users to be able to access CodeCommit repositories.  Each user needs to have an AWS IAM user account configured with appropriate policies attached.  There are canned policies for administrative, power user, and read only access and it should be simple enough to adjust the stock policies for more granular permissions if necessary (For instance, limiting which repositories users can access).  Each IAM user also needs to have an additional SSH key policy attached with the public key embedded in the policy.  This second policy is only necessary when using SSH to access repositories.  If you’re planning on dealing with a number of users, the policies can also be assigned to groups in order to simplify management.  Keep in mind there are additional costs associated with the IAM and KMS products too.  It’s something like $1 per SSH key per month plus the charge based on the number of requests made.</p><p>The last piece of configuration, if you’re using SSH you need to add an entry to your ~/.ssh/config for the AWS CodeCommit service endpoint and specify your username.  The username is an access key that is associated with the SSH public key when it is embedded in the IAM policy.  If you’re using HTTPS instead of SSH, then you’ll need to install the AWS CLI tools to work with your IAM account and then configure git to use it as a credential helper.  Once that is all setup, you can go on using git like normal with the AWS CodeCommit repositories.</p><p>The AWS console has a simple interface for creating new repositories, with only the repository name and its description the only inputs.  I was pleasantly surprised to see that the UI is able to display repository content and renders markdown, including default display of README.md files.  There are options for retrieving the repository URL in either SSH or HTTPS format and selecting the branch being displayed.  Settings-wise, the only other feature is to set the default branch.</p><p>Once I had my repositories created, all I had left to do was push my working copies to the new URLs.  The documentation recommends making a fresh clone and using the –mirror option when doing these migrations.  Since I didn’t have access to my upstream server anymore, I just did a push of my existing clones.  This seemed to work just fine for my basic repositories.</p><p>An interesting aspect of the repository URLs, they don’t appear to be namespaced to any sort of account or user.  This is unlike github, where each repository is anchored to an organization or username.  I’m not sure if this means that there is a single global repository namespace similar to the way S3 bucket names are first come, first serve or if there is a backend process that disambiguates the repository name based on the IAM user / account correlation.</p><h2 id=final-thoughts> Final Thoughts</h2><p>Overall, I’m happy with the service.  Setup wasn’t overly complex and the documentation was all very clear about the required steps to get going.  After that it pretty much just works.  If you’re looking for a hosted git solution with all of the bells and whistles of modern social code hosting products a la Github or Gitlab, this isn’t it.  If all you need is a stripped down basic hosted git server, this should fit the bill perfectly.</p><p>One issue that did trip me up after a bit of use was the HTTPS-based user credential setup.  I had setup one of my Macbook Pro laptops to use HTTPS instead of SSH.  Even though it seemed to work just fine when I initially configured the credential helper, it eventually stopped working.  After a bit of troubleshooting, I found that the credentials were cached in my keychain.  The credential helper only provides a short term access token that eventually expires.  I had to remove the cached credential from my keychain and make sure to not save it in the future any time I pushed a repository.</p></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div class=sticky-sidebar><aside class=toc><h5>Table Of Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><a href=#the-picture-so-far>The Picture So Far</a></li><li><a href=#a-time-for-change>A Time For Change</a></li><li><a href=#getting-setup>Getting Setup</a></li><li><a href=#final-thoughts> Final Thoughts</a></li></ul></nav></div></aside></div></div></div><div class=row><div class="col-sm-12 col-md-12 col-lg-9 p-4"></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script></div><footer><div class="container py-3" id=recent-posts></div><div class="text-center pt-2"><span class=px-1><a href=https://github.com/farrcraft aria-label=github><svg xmlns="http://www.w3.org/2000/svg" width="2.7em" height="2.7em" viewBox="0 0 1792 1792"><path d="M522 1352q-8 9-20-3-13-11-4-19 8-9 20 3 12 11 4 19zm-42-61q9 12 0 19-8 6-17-7t0-18q9-7 17 6zm-61-60q-5 7-13 2-10-5-7-12 3-5 13-2 10 5 7 12zm31 34q-6 7-16-3-9-11-2-16 6-6 16 3 9 11 2 16zm129 112q-4 12-19 6-17-4-13-15t19-7q16 5 13 16zm63 5q0 11-16 11-17 2-17-11 0-11 16-11 17-2 17 11zm58-10q2 10-14 14t-18-8 14-15q16-2 18 9zm964-956v960q0 119-84.5 203.5T1376 1664h-224q-16 0-24.5-1t-19.5-5-16-14.5-5-27.5v-239q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105T1386 856q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27T578 459.5 492 446q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5T484 1274q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 103t.5 68q0 22-11 33.5t-22 13-33 1.5H416q-119 0-203.5-84.5T128 1376V416q0-119 84.5-203.5T416 128h960q119 0 203.5 84.5T1664 416z"/></svg></a></span><span class=px-1><a href=https://www.linkedin.com/in/josh-farr/ aria-label=linkedin><svg xmlns="http://www.w3.org/2000/svg" width="2.4em" height="2.4em" fill="#fff" aria-label="LinkedIn" viewBox="0 0 512 512"><rect width="512" height="512" fill="#0077b5" rx="15%"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg></a></span></div><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center"><div class=pb-2><a href=https://farrcraft.com/ title=farrcraft.com><img alt="Footer logo" src=/favicon.png height=40px width=40px></a></div>&copy; 2022 All Rights Reserved</div></div></div></footer><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))});var tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')),tooltipList=tooltipTriggerList.map(function(e){return new bootstrap.Tooltip(e)})</script><script>let loadingIcons;function loading(){myVar=setTimeout(showPage,100)}function showPage(){try{document.getElementById("loading-icons").style.display="block"}catch{}}</script></body></html>